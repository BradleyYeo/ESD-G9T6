<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div id="main-container" class="container">
        <h1 class="display-4">Cart Listing</h1>
        <table class='table table-striped border-1'>
            <thead class='table-dark'>
                <tr>
                    <th>Customer Id</th>
                    <th>Product Name</th>
                    <th>Price</th>
                    <th>Quantity</th>
                </tr>
            </thead>
        	<tbody id="cartTable"></tbody>
        </table>
    </div> 
    
    <script>
        // Helper function to display error message
        function showError(message) {
            // Display an error under the main container
            $('#main-container')
                .append("<label>"+message+"</label>");
        }
    
        // anonymous async function 
        // - using await requires the function that calls it to be async
        $(async() => {           
            // Change serviceURL to your own
            var serviceURL = "http://127.0.0.1:5000/cart";
    
            try {
                const response =
                    await fetch(
                    serviceURL, { method: 'GET' }
                );
                const result = await response.json();
                    if (response.status === 200) {
                    // success case
                    var carts = result.data.carts; //the array is in books within data of 
                                                   // the returned result
                    // for loop to setup all table rows with obtained book data
                    var rows = "";
                    for (const cart of carts) {
                        eachRow ="<td>" + cart.customer_id + "</td>" +
                                "<td>" + cart.product_name + "</td>" +
                                "<td>" + cart.price + "</td>" +
                                "<td>" + cart.quantity + "</td>";
                        rows += "<tr>" + eachRow + "</tr>";
                    }
                        // add all the rows to the table
                        $('#cartTable').append(rows);
                    } else if (response.status == 404) {
                        // No books
                        showError(result.message);
                    } else {
                        // unexpected outcome, throw the error
                        throw response.status;
                    }
                } catch (error) {
                    // Errors when calling the service; such as network error, 
                    // service offline, etc
                    showError
        ('There is a problem retrieving books data, please try again later.<br />' + error);
                } // error
        });
    </script>
</body>
</html>